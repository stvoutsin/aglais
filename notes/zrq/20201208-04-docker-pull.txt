#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2020, ROE (http://www.roe.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#

    Target:

        Login to our master node and explore ..

    Result:

        Work in progress ....


# -----------------------------------------------------
# List our clusters.
#[user@openstacker]

    openstack \
        --os-cloud "${cloudname:?}" \
        coe cluster list

    >   +--------------------------------------+-----------------------------+------------------+------------+--------------+-----------------+---------------+
    >   | uuid                                 | name                        | keypair          | node_count | master_count | status          | health_status |
    >   +--------------------------------------+-----------------------------+------------------+------------+--------------+-----------------+---------------+
    >   | 1243a091-7741-453d-a836-893cc999ec58 | aglais-k8s-20201208-cluster | zrq-gaia-keypair |          4 |            1 | CREATE_COMPLETE | HEALTHY       |
    >   +--------------------------------------+-----------------------------+------------------+------------+--------------+-----------------+---------------+


# -----------------------------------------------------
# List our servers.
#[user@openstacker]

    openstack \
        --os-cloud "${cloudname:?}" \
        server list


    >   +--------------------------------------+---------------------------------------------------+--------+--------------------+-------------------------+-------------------+
    >   | ID                                   | Name                                              | Status | Networks           | Image                   | Flavor            |
    >   +--------------------------------------+---------------------------------------------------+--------+--------------------+-------------------------+-------------------+
    >   | aeab8066-b55e-403d-bc4f-6139065e89b6 | aglais-k8s-20201208-cluster-p5qlctagesrg-node-2   | ACTIVE | private=10.0.0.40  | FedoraAtomic29-20191126 | general.v1.medium |
    >   | 5628cbe1-90dd-4843-a7ef-31c72a00f608 | aglais-k8s-20201208-cluster-p5qlctagesrg-node-1   | ACTIVE | private=10.0.0.139 | FedoraAtomic29-20191126 | general.v1.medium |
    >   | 9ae246b9-739b-45f6-9a60-cdf4fc06b53a | aglais-k8s-20201208-cluster-p5qlctagesrg-node-3   | ACTIVE | private=10.0.0.111 | FedoraAtomic29-20191126 | general.v1.medium |
    >   | 0c4791b8-9772-41c0-8b18-926ffcd4e6b1 | aglais-k8s-20201208-cluster-p5qlctagesrg-node-0   | ACTIVE | private=10.0.0.129 | FedoraAtomic29-20191126 | general.v1.medium |
    >   | 85b97722-c9cd-40cf-8ae7-a5964a402f1e | aglais-k8s-20201208-cluster-p5qlctagesrg-master-0 | ACTIVE | private=10.0.0.60  | FedoraAtomic29-20191126 | general.v1.tiny   |
    >   +--------------------------------------+---------------------------------------------------+--------+--------------------+-------------------------+-------------------+


# -----------------------------------------------------
# Create a gateway node for us to login to.
# -----------------------------------------------------

# -----------------------------------------------------
# Get the name of our keypair.
#[user@openstacker]

    keyname=$(
        openstack \
            --os-cloud "${cloudname}" \
            keypair list \
                --format json \
        | jq -r '.[0] | .Name'
        )

    echo "Key name [${keyname:?}]"

    >   Key name [zrq-gaia-keypair]


# -----------------------------------------------------
# Get the name of our K8s cluster.
#[user@openstacker]

    clustername=$(
        openstack \
            --os-cloud "${cloudname}" \
            coe cluster list \
                --format json \
        | jq -r '.[0] | .name'
        )

    echo "Cluster name [${clustername:?}]"

    >   Cluster name [aglais-k8s-20201208-cluster]


# -----------------------------------------------------
# Find the subnet and network ID for our K8s cluster.
#[user@openstacker]

    openstack \
        --os-cloud "${cloudname:?}" \
        subnet list

    >   +--------------------------------------+-------------------------------------------------------------------------------------------+--------------------------------------+---------------+
    >   | ID                                   | Name                                                                                      | Network                              | Subnet        |
    >   +--------------------------------------+-------------------------------------------------------------------------------------------+--------------------------------------+---------------+
    >   | 01b76c7c-3c1a-4c5c-9a5a-14bcf6c0c290 | cumulus-internal                                                                          | ecb791d5-1022-447a-a79c-8f38a0f5c990 | 10.218.0.0/16 |
    >   | 113351d3-2b56-4f18-8dcb-7421ecbab7e1 | aglais-k8s-20201208-cluster-p5qlctagesrg-network-dhhp535mjf3m-private_subnet-duswqrqwtbvo | a6a155b3-d481-43eb-a4ce-be69d4686f49 | 10.0.0.0/24   |
    >   +--------------------------------------+-------------------------------------------------------------------------------------------+--------------------------------------+---------------+


    # Note - the subnet name includes a lowercase version of the clustername.
    # So the 'jq' select needs to convert ${clustername} to lowercase.

    subnetid=$(
        openstack \
            --os-cloud "${cloudname:?}" \
            subnet list \
                --format json \
        | jq -r '.[] | select(.Name | startswith("'${clustername,,}'")) | .ID'
        )

    networkid=$(
        openstack \
            --os-cloud "${cloudname:?}" \
            subnet show \
                --format json \
                "${subnetid:?}" \
        | jq -r '.network_id'
        )

cat << EOF
Subnet  [${subnetid:?}]
Network [${networkid:?}]
EOF

    >   Subnet  [113351d3-2b56-4f18-8dcb-7421ecbab7e1]
    >   Network [a6a155b3-d481-43eb-a4ce-be69d4686f49]


# -----------------------------------------------------
# Get the ID of the Fedora image.
#[user@openstacker]

    imageid=$(
        openstack \
            --os-cloud "${cloudname}" \
            image list \
                --format json \
        | jq -r '.[] | select(.Name | test("Fedora-30")) | .ID'
        )

    echo "Image ID [${imageid:?}]"

    >   Image ID [ade3a5aa-a6a3-4761-8eed-083e5ce1f117]


# -----------------------------------------------------
# Get the ID of the tiny flavor.
#[user@openstacker]

    flavorid=$(
        openstack \
            --os-cloud "${cloudname}" \
            flavor list \
                --format json \
        | jq -r '.[] | select(.Name == "general.v1.tiny") | .ID'
        )

    echo "Flavor ID [${flavorid:?}]"

    >   Flavor ID [406a17e0-afd0-47d3-a6ad-8b19198bdd97]


# -----------------------------------------------------
# Create our VM instance.
#[user@openstacker]

    servername=${clustername,,}-gateway

    openstack \
        --os-cloud "${cloudname}" \
        server create \
            --format json \
            --image  "${imageid:?}" \
            --flavor "${flavorid:?}" \
            --network  "${networkid:?}" \
            --key-name "${keyname:?}" \
            "${servername:?}" \
    | tee '/tmp/server.json' \
    | jq '.'

    >   {
    >     "OS-DCF:diskConfig": "MANUAL",
    >     "OS-EXT-AZ:availability_zone": "",
    >     "OS-EXT-STS:power_state": "NOSTATE",
    >     "OS-EXT-STS:task_state": "scheduling",
    >     "OS-EXT-STS:vm_state": "building",
    >     "OS-SRV-USG:launched_at": null,
    >     "OS-SRV-USG:terminated_at": null,
    >     "accessIPv4": "",
    >     "accessIPv6": "",
    >     "addresses": "",
    >     "adminPass": "sRyBrE7bGSNV",
    >     "config_drive": "",
    >     "created": "2020-12-08T14:10:33Z",
    >     "flavor": "general.v1.tiny (406a17e0-afd0-47d3-a6ad-8b19198bdd97)",
    >     "hostId": "",
    >     "id": "fe74be86-f1bd-4bb7-b4ae-a47fa847dcdc",
    >     "image": "Fedora-30-1.2 (ade3a5aa-a6a3-4761-8eed-083e5ce1f117)",
    >     "key_name": "zrq-gaia-keypair",
    >     "name": "aglais-k8s-20201208-cluster-gateway",
    >     "progress": 0,
    >     "project_id": "21b4ae3a2ea44bc5a9c14005ed2963af",
    >     "properties": "",
    >     "security_groups": [
    >       {
    >         "name": "default"
    >       }
    >     ],
    >     "status": "BUILD",
    >     "updated": "2020-12-08T14:10:33Z",
    >     "user_id": "98169f87de174ad4ac98c32e59646488",
    >     "volumes_attached": []
    >   }


    vmident=$(
        jq -r '.id' '/tmp/server.json'
        )

    echo "VM ident [${vmident:?}]"

    >   VM ident [fe74be86-f1bd-4bb7-b4ae-a47fa847dcdc]


# -----------------------------------------------------
# Get the network ID of the internet.
#[user@openstacker]

    internet=$(
        openstack \
            --os-cloud "${cloudname}" \
            network list \
                --format json \
        | jq -r '
            .[] | select(.Name | test("internet")) | .ID
            '
        )

    echo "Internet [${internet}]"

    >   Internet [a929e8db-1bf4-4a5f-a80c-fabd39d06a26]


# -----------------------------------------------------
# Create a public IP address.
#[user@openstacker]

    floatip=$(
        openstack \
            --os-cloud "${cloudname}" \
            floating ip \
            create \
            --format json \
            "${internet:?}" \
        | jq -r '.floating_ip_address'
        )

    echo "Float IP [${floatip}]"

    >   Float IP [128.232.227.158]


# -----------------------------------------------------
# Link the public IP address to our VM.
#[user@openstacker]

    vmaddress=$(
        openstack \
            --os-cloud "${cloudname}" \
            server show \
                --format json \
                "${vmident:?}" \
        | jq -r '.addresses' \
        | sed '
            s/private=\([0-9. ]*\).*/\1/
            '
        )

    openstack \
        --os-cloud "${cloudname}" \
        server add \
            floating ip \
            --fixed-ip-address "${vmaddress:?}" \
            "${vmident:?}" \
            "${floatip:?}"


# -----------------------------------------------------
# Create a new security group.
#[user@openstacker]

    openstack \
        --os-cloud "${cloudname}" \
        security group create \
            --format json \
            'External SSH' \
    | jq '.' \
    | tee /tmp/security.json


    groupid=$(
        jq -r '.id' /tmp/security.json
        )

    echo "SSH access [${groupid}]"

    >   SSH access [3935e442-f54b-4326-be2f-ce8b82281333]


# -----------------------------------------------------
# Add a rule to allow inbound ssh.
#[user@openstacker]

    openstack \
        --os-cloud "${cloudname}" \
        security group rule create \
            --ingress \
            --dst-port   22 \
            --protocol  'tcp' \
            --ethertype 'IPv4' \
            "${groupid}"

    >   +-------------------+--------------------------------------+
    >   | Field             | Value                                |
    >   +-------------------+--------------------------------------+
    >   | created_at        | 2020-12-08T14:17:42Z                 |
    >   | description       |                                      |
    >   | direction         | ingress                              |
    >   | ether_type        | IPv4                                 |
    >   | id                | 60e3e0b1-8e9c-4102-91c8-defa942658b3 |
    >   | name              | None                                 |
    >   | port_range_max    | 22                                   |
    >   | port_range_min    | 22                                   |
    >   | project_id        | 21b4ae3a2ea44bc5a9c14005ed2963af     |
    >   | protocol          | tcp                                  |
    >   | remote_group_id   | None                                 |
    >   | remote_ip_prefix  | 0.0.0.0/0                            |
    >   | revision_number   | 0                                    |
    >   | security_group_id | 3935e442-f54b-4326-be2f-ce8b82281333 |
    >   | tags              | []                                   |
    >   | updated_at        | 2020-12-08T14:17:42Z                 |
    >   +-------------------+--------------------------------------+


# -----------------------------------------------------
# Get the network port id on our VM.
#[user@openstacker]

    portid=$(
        openstack \
            --os-cloud "${cloudname}" \
            port list \
                --format json \
                --server "${vmident}" \
        | jq -r '.[0] | .ID'
        )


# -----------------------------------------------------
# Add the new security group to our network port.
#[user@openstacker]

    openstack \
        --os-cloud "${cloudname}" \
        port set \
            --security-group "${groupid}" \
            "${portid}"


# -----------------------------------------------------
# -----------------------------------------------------
# Try ssh from desktop to the gateway VM.
#[user@desktop]

    sshuser=fedora
    sshhost=128.232.227.158

    ssh "${sshuser:?}@${sshhost:?}" \
        '
        date
        hostname
        '

    >   Tue  8 Dec 14:18:54 UTC 2020
    >   aglais-k8s-20201208-cluster-gateway.novalocal


# -----------------------------------------------------
# Try ssh from the gateway VM to our K8s master.
#[user@desktop]

    sshuser=fedora
    sshhost=128.232.227.158

    ssh "${sshuser:?}@${sshhost:?}" \
        '
        date
        hostname
        echo "---- ----"
        ssh "fedora@10.0.0.60" \
            "
            date
            hostname
            "
        echo "---- ----"
        '

    >   Tue  8 Dec 14:21:57 UTC 2020
    >   aglais-k8s-20201208-cluster-gateway.novalocal
    >   ---- ----
    >   Tue Dec  8 14:21:57 UTC 2020
    >   aglais-k8s-20201208-cluster-p5qlctagesrg-master-0.novalocal
    >   ---- ----


# -----------------------------------------------------
# Login to our K8s master and explore.
#[user@desktop]

    sshuser=fedora
    sshhost=128.232.227.158

    ssh "${sshuser:?}@${sshhost:?}"

        ssh "fedora@10.0.0.60"

# -----------------------------------------------------
# Check if Docker is running the show ...
#[user@master-0]

    docker ps

    >   Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.26/containers/json: dial unix /var/run/docker.sock: connect: permission denied


    sudo docker ps

    >   CONTAINER ID        IMAGE                                                                                                                                   COMMAND                  CREATED             STATUS              PORTS               NAMES
    >   264492b98bb1        docker.io/openstackmagnum/cluster-autoscaler@sha256:5f06fa3d9251e34d56f5f918c302ca198e153691eec8f8fc7f662a53b8df520f                    "./cluster-autosca..."   12 hours ago        Up 12 hours                             k8s_cluster-autoscaler_cluster-autoscaler-5fb8fb6488-b2bh8_kube-system_516d26ea-2499-45e7-9d82-6b5677ba5e64_4
    >   3d3ad8a07278        quay.io/prometheus/node-exporter@sha256:a2f29256e53cc3e0b64d7a472512600b2e9410347d53cdc85b49f659c17e02ee                                "/bin/node_exporte..."   12 hours ago        Up 12 hours                             k8s_node-exporter_prometheus-operator-prometheus-node-exporter-6bdnf_kube-system_4384244b-8add-4aab-bb6b-416360f52dc9_0
    >   89652493d674        gcr.io/google_containers/pause:3.0                                                                                                      "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_prometheus-operator-prometheus-node-exporter-6bdnf_kube-system_4384244b-8add-4aab-bb6b-416360f52dc9_0
    >   3644f4bb2f7a        gcr.io/kubernetes-helm/tiller@sha256:3c70ee359d3ec305ca469395a2481b2375d569c6b4a928389ca07d829d12ec51                                   "/tiller"                12 hours ago        Up 12 hours                             k8s_tiller_tiller-deploy-6f765b5596-4wflw_magnum-tiller_590ed10e-9c9b-4758-a072-2b2038141a15_0
    >   ff82d4bc2c35        gcr.io/google_containers/pause:3.0                                                                                                      "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_tiller-deploy-6f765b5596-4wflw_magnum-tiller_590ed10e-9c9b-4758-a072-2b2038141a15_0
    >   a633b29956e6        docker.io/k8scloudprovider/openstack-cloud-controller-manager@sha256:a80a206873da38350b47e4bc50379ee924863fa002eb7836864fceed137fc046   "/bin/openstack-cl..."   12 hours ago        Up 12 hours                             k8s_openstack-cloud-controller-manager_openstack-cloud-controller-manager-x2p8b_kube-system_a922b177-5060-4e1e-a766-7b3d6e45c8e5_0
    >   7b32a74250bf        gcr.io/google_containers/pause:3.0                                                                                                      "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_openstack-cloud-controller-manager-x2p8b_kube-system_a922b177-5060-4e1e-a766-7b3d6e45c8e5_0
    >   e3a6bf818878        gcr.io/google_containers/pause:3.0                                                                                                      "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_cluster-autoscaler-5fb8fb6488-b2bh8_kube-system_516d26ea-2499-45e7-9d82-6b5677ba5e64_0
    >   a08b38231e0f        ff281650a721                                                                                                                            "/opt/bin/flanneld..."   12 hours ago        Up 12 hours                             k8s_kube-flannel_kube-flannel-ds-amd64-cjxh6_kube-system_2a68fbc3-cb4f-47da-bcb9-302883b7ffb6_0
    >   d711c09bcf31        docker.io/k8scloudprovider/k8s-keystone-auth@sha256:f0baca8d0c945e4228e0901338acb6dfff2fa20844781f6d7176d4b562e18e60                    "./bin/k8s-keyston..."   12 hours ago        Up 12 hours                             k8s_k8s-keystone-auth_k8s-keystone-auth-r54rf_kube-system_41c029d1-1593-4412-90d1-5fd4c6a38d94_0
    >   a08481663639        docker.io/k8scloudprovider/magnum-auto-healer@sha256:7ca136f6460b83c3c3ca77d9bf1c61cab0ff4c18676a43efdaf95debb93d0994                   "/bin/magnum-auto-..."   12 hours ago        Up 12 hours                             k8s_magnum-auto-healer_magnum-auto-healer-7vdv4_kube-system_5f761eed-6b5b-4dd9-b1b0-349f7498f2b3_0
    >   98ec66dbdc28        gcr.io/google_containers/pause:3.0                                                                                                      "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_k8s-keystone-auth-r54rf_kube-system_41c029d1-1593-4412-90d1-5fd4c6a38d94_0
    >   00cd3603781a        gcr.io/google_containers/pause:3.0                                                                                                      "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_kube-flannel-ds-amd64-cjxh6_kube-system_2a68fbc3-cb4f-47da-bcb9-302883b7ffb6_0
    >   f9bfc4a43266        gcr.io/google_containers/pause:3.0                                                                                                      "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_magnum-auto-healer-7vdv4_kube-system_5f761eed-6b5b-4dd9-b1b0-349f7498f2b3_0


    sudo docker images

    >   REPOSITORY                                                      TAG                 IMAGE ID            CREATED             SIZE
    >   docker.io/openstackmagnum/cluster-autoscaler                    v1.15.2             5f4076c4dc49        8 months ago        38 MB
    >   docker.io/k8scloudprovider/openstack-cloud-controller-manager   v1.17.0             10827a7fffa0        12 months ago       47.2 MB
    >   gcr.io/kubernetes-helm/tiller                                   v2.16.1             1f92aa902d73        13 months ago       91.2 MB
    >   docker.io/k8scloudprovider/magnum-auto-healer                   v1.15.0             2e9c524a09f2        17 months ago       34.9 MB
    >   quay.io/prometheus/node-exporter                                v0.18.1             e5a616e4b9cf        18 months ago       22.9 MB
    >   docker.io/k8scloudprovider/k8s-keystone-auth                    v1.14.0             4957bc944569        20 months ago       32.6 MB
    >   quay.io/coreos/flannel                                          v0.11.0-amd64       ff281650a721        22 months ago       52.6 MB
    >   quay.io/coreos/flannel-cni                                      v0.3.0              221392217215        3 years ago         49.8 MB
    >   gcr.io/google_containers/pause                                  3.0                 99e59f495ffa        4 years ago         747 kB


# -----------------------------------------------------
# Check if Podman is running the show ...
#[user@master-0]

    podman ps

    >   CONTAINER ID  IMAGE  COMMAND  CREATED  STATUS  PORTS  NAMES


    podman images

    >   REPOSITORY   TAG   IMAGE ID   CREATED   SIZE


# -----------------------------------------------------
# Login to one of our K8s workes and explore.
#[user@desktop]

    sshuser=fedora
    sshhost=128.232.227.158

    ssh "${sshuser:?}@${sshhost:?}"

        ssh "fedora@10.0.0.40"


# -----------------------------------------------------
# Check if Podman is running the show ...
#[user@node-2]

    podman ps

    >   CONTAINER ID  IMAGE  COMMAND  CREATED  STATUS  PORTS  NAMES


    podman images

    >   REPOSITORY   TAG   IMAGE ID   CREATED   SIZE


# -----------------------------------------------------
# Check if Docker is running the show ...
#[user@node-2]

    sudo docker ps

    >   CONTAINER ID        IMAGE                                                                                                                         COMMAND                  CREATED             STATUS              PORTS               NAMES
    >   441947cacc44        docker.io/aglais/drupal-mod@sha256:697715f6b146d35410deb08f56b7ad30b3eef4171a38c63b498be7eebdd1486e                           "docker-php-entryp..."   9 hours ago         Up 9 hours                              k8s_aglais-drupal-drupal-pod_aglais-drupal-drupal-deploy-7b9b675848-bmrqq_aglais-k8s-20201208_a0004824-0ec9-4cad-88fb-4657bf7fe2eb_0
    >   826735216cb0        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 9 hours ago         Up 9 hours                              k8s_POD_aglais-drupal-drupal-deploy-7b9b675848-bmrqq_aglais-k8s-20201208_a0004824-0ec9-4cad-88fb-4657bf7fe2eb_0
    >   2dcaecf8b52d        3a348a04a815                                                                                                                  "docker-entrypoint..."   9 hours ago         Up 9 hours                              k8s_aglais-drupal-database-pod_aglais-drupal-database-deploy-57f8fc756f-bkh9x_aglais-k8s-20201208_ab028e73-16c7-4ba2-9bce-370dc020af68_0
    >   c595a8318dda        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 9 hours ago         Up 9 hours                              k8s_POD_aglais-drupal-database-deploy-57f8fc756f-bkh9x_aglais-k8s-20201208_ab028e73-16c7-4ba2-9bce-370dc020af68_0
    >   3b7e7cde37b2        docker.io/fedora@sha256:aa889c59fc048b597dcfab40898ee3fcaad9ed61caf12bcfef44493ee670e9df                                      "/bin/sh -c 'while..."   9 hours ago         Up 9 hours                              k8s_testpod-container_testpod_aglais-k8s-20201208_a2780f11-d1a7-409b-85db-a2048a0ed5d8_0
    >   080cc90e2865        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 9 hours ago         Up 9 hours                              k8s_POD_testpod_aglais-k8s-20201208_a2780f11-d1a7-409b-85db-a2048a0ed5d8_0
    >   44c3863d1a19        docker.io/aglais/zeppelin-mod@sha256:22d81978852421416d22536d92c528c766fdd490d3c48bd3d11ba44b356e0d85                         "sh -c '/zeppelin/..."   11 hours ago        Up 11 hours                             k8s_sh_sh-ieobdk_aglais-k8s-20201208_6b775645-c015-423d-aec6-4944a1f9e81a_0
    >   98010396a4b9        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 11 hours ago        Up 11 hours                             k8s_POD_sh-ieobdk_aglais-k8s-20201208_6b775645-c015-423d-aec6-4944a1f9e81a_0
    >   47e0b2c314a6        docker.io/janeczku/go-dnsmasq@sha256:56119a82f973247eda467303dabe1c04034b6ee75fb2c2534f516b3bfdf14123                         "/go-dnsmasq --lis..."   11 hours ago        Up 11 hours                             k8s_zeppelin-server-dnsmasq_zeppelin-server-deploy-69d97dff6c-ht6ll_aglais-k8s-20201208_230c9358-00f6-407f-8cad-4d58b00188c8_0
    >   cdcddd646803        docker.io/nginx@sha256:8b600a4d029481cc5b459f1380b30ff6cb98e27544fc02370de836e397e34030                                       "/bin/sh -c 'cp -f..."   11 hours ago        Up 11 hours                             k8s_zeppelin-server-nginx_zeppelin-server-deploy-69d97dff6c-ht6ll_aglais-k8s-20201208_230c9358-00f6-407f-8cad-4d58b00188c8_0
    >   b43c4b66537e        docker.io/aglais/zeppelin-mod@sha256:22d81978852421416d22536d92c528c766fdd490d3c48bd3d11ba44b356e0d85                         "sh -c /zeppelin/b..."   11 hours ago        Up 11 hours                             k8s_zeppelin-server-actual_zeppelin-server-deploy-69d97dff6c-ht6ll_aglais-k8s-20201208_230c9358-00f6-407f-8cad-4d58b00188c8_0
    >   323eee9c655e        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 11 hours ago        Up 11 hours                             k8s_POD_zeppelin-server-deploy-69d97dff6c-ht6ll_aglais-k8s-20201208_230c9358-00f6-407f-8cad-4d58b00188c8_0
    >   1d67173cb12c        650757c4f32d                                                                                                                  "/usr/local/bin/ce..."   12 hours ago        Up 12 hours                             k8s_liveness-prometheus_aglais-ceph-csi-cephfs-provisioner-f9ff8cd4c-rfmwg_aglais-k8s-20201208_352d1212-a7cd-4ac2-9923-b3a32b3720d2_0
    >   be170a4cfea2        650757c4f32d                                                                                                                  "/usr/local/bin/ce..."   12 hours ago        Up 12 hours                             k8s_csi-cephfsplugin_aglais-ceph-csi-cephfs-provisioner-f9ff8cd4c-rfmwg_aglais-k8s-20201208_352d1212-a7cd-4ac2-9923-b3a32b3720d2_0
    >   7704dafc44e5        quay.io/k8scsi/csi-resizer@sha256:6c6a0332693a7c456378f6abd2bb40611826c1e1a733cadbdae2daab3125b71c                            "/csi-resizer --v=..."   12 hours ago        Up 12 hours                             k8s_csi-resizer_aglais-ceph-csi-cephfs-provisioner-f9ff8cd4c-rfmwg_aglais-k8s-20201208_352d1212-a7cd-4ac2-9923-b3a32b3720d2_0
    >   5a939af0c398        quay.io/k8scsi/csi-attacher@sha256:4bfcf54fde2be69ccf122bc19dd10389013292b49e7d8a57d1eaa013c3672a91                           "/csi-attacher --v..."   12 hours ago        Up 12 hours                             k8s_csi-attacher_aglais-ceph-csi-cephfs-provisioner-f9ff8cd4c-rfmwg_aglais-k8s-20201208_352d1212-a7cd-4ac2-9923-b3a32b3720d2_0
    >   12994d82cae6        quay.io/k8scsi/csi-snapshotter@sha256:de94e695fc27ee421da8b9932c3d42699fe7b848bc34717f67f4350946bc46c9                        "/csi-snapshotter ..."   12 hours ago        Up 12 hours                             k8s_csi-snapshotter_aglais-ceph-csi-cephfs-provisioner-f9ff8cd4c-rfmwg_aglais-k8s-20201208_352d1212-a7cd-4ac2-9923-b3a32b3720d2_0
    >   ee2ac0f1a5e2        650757c4f32d                                                                                                                  "/usr/local/bin/ce..."   12 hours ago        Up 12 hours                             k8s_liveness-prometheus_aglais-ceph-csi-cephfs-nodeplugin-824b8_aglais-k8s-20201208_aaca329e-aa38-440a-8203-179a140a3c13_0
    >   82e302e6d530        quay.io/cephcsi/cephcsi@sha256:afd643c2805029f14862bf8976916ce6ec894b172334eae7c4a74bd717df8f2d                               "/usr/local/bin/ce..."   12 hours ago        Up 12 hours                             k8s_csi-cephfsplugin_aglais-ceph-csi-cephfs-nodeplugin-824b8_aglais-k8s-20201208_aaca329e-aa38-440a-8203-179a140a3c13_0
    >   aadd52f5f6ff        docker.io/k8scloudprovider/manila-csi-plugin@sha256:5a12df340149eab73f9c821facb47eca10ad7c9ca6130768b68178504ad42355          "/bin/sh -c '/bin/..."   12 hours ago        Up 12 hours                             k8s_cephfs-nodeplugin_aglais-openstack-manila-csi-nodeplugin-8x7dg_aglais-k8s-20201208_1ed9a5e4-0145-43a8-9e79-64a30c74bc53_0
    >   5f7dba0ae098        quay.io/k8scsi/csi-provisioner@sha256:78e3393f5fd5ff6c1e5dada2478cfa456fb7164929e573cf9a87bf6532730679                        "/csi-provisioner ..."   12 hours ago        Up 12 hours                             k8s_csi-provisioner_aglais-ceph-csi-cephfs-provisioner-f9ff8cd4c-rfmwg_aglais-k8s-20201208_352d1212-a7cd-4ac2-9923-b3a32b3720d2_0
    >   09f9efe9a3a6        quay.io/k8scsi/csi-node-driver-registrar@sha256:9622c6a6dac7499a055a382930f4de82905a3c5735c0753f7094115c9c871309              "/csi-node-driver-..."   12 hours ago        Up 12 hours                             k8s_driver-registrar_aglais-ceph-csi-cephfs-nodeplugin-824b8_aglais-k8s-20201208_aaca329e-aa38-440a-8203-179a140a3c13_0
    >   fee178206c19        quay.io/k8scsi/csi-node-driver-registrar@sha256:13daf82fb99e951a4bff8ae5fc7c17c3a8fe7130be6400990d8f6076c32d4599              "/csi-node-driver-..."   12 hours ago        Up 12 hours                             k8s_cephfs-registrar_aglais-openstack-manila-csi-nodeplugin-8x7dg_aglais-k8s-20201208_1ed9a5e4-0145-43a8-9e79-64a30c74bc53_0
    >   cff4865e93db        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_aglais-ceph-csi-cephfs-provisioner-f9ff8cd4c-rfmwg_aglais-k8s-20201208_352d1212-a7cd-4ac2-9923-b3a32b3720d2_0
    >   1229b233cce4        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_aglais-ceph-csi-cephfs-nodeplugin-824b8_aglais-k8s-20201208_aaca329e-aa38-440a-8203-179a140a3c13_0
    >   3b4908664504        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_aglais-openstack-manila-csi-nodeplugin-8x7dg_aglais-k8s-20201208_1ed9a5e4-0145-43a8-9e79-64a30c74bc53_0
    >   d5a4ced0b0cb        docker.io/grafana/grafana@sha256:8c2238eea9d3d39aeb6174db2e30b233fd2546128ec1fa1bc64f8058afd51e68                             "/run.sh"                12 hours ago        Up 12 hours                             k8s_grafana_prometheus-operator-grafana-597f5fdffc-b62m9_kube-system_c75c7fce-6685-48e3-a886-b91cabfe04eb_0
    >   50e607cc4174        bf8b33b96a31                                                                                                                  "python -u /app/si..."   12 hours ago        Up 12 hours                             k8s_grafana-sc-dashboard_prometheus-operator-grafana-597f5fdffc-b62m9_kube-system_c75c7fce-6685-48e3-a886-b91cabfe04eb_0
    >   e0044448efe7        quay.io/prometheus/node-exporter@sha256:a2f29256e53cc3e0b64d7a472512600b2e9410347d53cdc85b49f659c17e02ee                      "/bin/node_exporte..."   12 hours ago        Up 12 hours                             k8s_node-exporter_prometheus-operator-prometheus-node-exporter-79g28_kube-system_cc9dc541-c8a4-4b84-917c-8a9fd6551041_0
    >   ec66996560a4        docker.io/directxman12/k8s-prometheus-adapter-amd64@sha256:acf4c4dc6aaa51e3004eebdc410b509db45d1a6ebd255457c5745f0b4671678f   "/adapter /adapter..."   12 hours ago        Up 12 hours                             k8s_prometheus-adapter_prometheus-adapter-7d5b6b75d7-ct6t5_kube-system_808ebe3e-9cf0-4777-98b2-96454a6a76d5_0
    >   6d7c3957072a        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_prometheus-operator-grafana-597f5fdffc-b62m9_kube-system_c75c7fce-6685-48e3-a886-b91cabfe04eb_0
    >   2a8075d7c925        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_prometheus-operator-prometheus-node-exporter-79g28_kube-system_cc9dc541-c8a4-4b84-917c-8a9fd6551041_0
    >   9d857282ff5c        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_prometheus-adapter-7d5b6b75d7-ct6t5_kube-system_808ebe3e-9cf0-4777-98b2-96454a6a76d5_0
    >   bf3f71d73baa        gcr.io/google_containers/kubernetes-dashboard-amd64@sha256:dc4026c1b595435ef5527ca598e1e9c4343076926d7d62b365c44831395adbd0   "/dashboard --inse..."   12 hours ago        Up 12 hours                             k8s_kubernetes-dashboard_kubernetes-dashboard-97f74d6d4-wnnfc_kube-system_f36f685d-4493-4862-9161-69e3d36e90d4_0
    >   3d45ea5952b5        k8s.gcr.io/node-problem-detector@sha256:6e9b4a4eaa47f120be61f60573a545844de63401661812e2cfb7ae81a28efd19                      "/bin/sh -c 'exec ..."   12 hours ago        Up 12 hours                             k8s_node-problem-detector_npd-7gb7r_kube-system_f177d865-988c-4790-9884-921a0ee9ac92_0
    >   81711ee431a2        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_kubernetes-dashboard-97f74d6d4-wnnfc_kube-system_f36f685d-4493-4862-9161-69e3d36e90d4_0
    >   1b3053f1e68b        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_npd-7gb7r_kube-system_f177d865-988c-4790-9884-921a0ee9ac92_0
    >   47ce3f5736a1        ff281650a721                                                                                                                  "/opt/bin/flanneld..."   12 hours ago        Up 12 hours                             k8s_kube-flannel_kube-flannel-ds-amd64-p7fc7_kube-system_ce412bf2-24bb-4652-a873-769003f2a91c_0
    >   652ac444e613        gcr.io/google_containers/pause:3.0                                                                                            "/pause"                 12 hours ago        Up 12 hours                             k8s_POD_kube-flannel-ds-amd64-p7fc7_kube-system_ce412bf2-24bb-4652-a873-769003f2a91c_0


    sudo docker images

    >   REPOSITORY                                            TAG                 IMAGE ID            CREATED             SIZE
    >   docker.io/aglais/drupal-mod                           latest              8e4202e4b399        26 hours ago        743 MB
    >   docker.io/aglais/zeppelin-mod                         latest              c23a211e7d30        5 days ago          4.47 GB
    >   docker.io/mariadb                                     10                  3a348a04a815        12 days ago         407 MB
    >   docker.io/fedora                                      latest              b3048463dcef        3 weeks ago         175 MB
    >   quay.io/cephcsi/cephcsi                               v3.1.1              650757c4f32d        2 months ago        1.03 GB
    >   quay.io/k8scsi/csi-snapshotter                        v2.1.1              56bf270fc5c8        7 months ago        46.3 MB
    >   quay.io/k8scsi/csi-resizer                            v0.5.0              29579abf2cc9        8 months ago        46 MB
    >   quay.io/k8scsi/csi-provisioner                        v1.6.0              a2ac6956643e        8 months ago        48.3 MB
    >   quay.io/k8scsi/csi-node-driver-registrar              v1.3.0              37c1d9ea538b        8 months ago        16.3 MB
    >   docker.io/k8scloudprovider/manila-csi-plugin          v1.18.0             4916a7efa540        8 months ago        44.8 MB
    >   quay.io/k8scsi/csi-attacher                           v2.1.1              b5c006a00556        10 months ago       46.1 MB
    >   docker.io/grafana/grafana                             6.4.2               808a15f85914        14 months ago       206 MB
    >   docker.io/kiwigrid/k8s-sidecar                        0.1.20              bf8b33b96a31        16 months ago       217 MB
    >   quay.io/prometheus/node-exporter                      v0.18.1             e5a616e4b9cf        18 months ago       22.9 MB
    >   quay.io/k8scsi/csi-node-driver-registrar              v1.1.0              a93898755322        20 months ago       15.8 MB
    >   docker.io/directxman12/k8s-prometheus-adapter-amd64   v0.5.0              1913a4c0e1d0        20 months ago       60.9 MB
    >   quay.io/coreos/flannel                                v0.11.0-amd64       ff281650a721        22 months ago       52.6 MB
    >   k8s.gcr.io/node-problem-detector                      v0.6.2              dcc1edb07ce5        23 months ago       98.7 MB
    >   docker.io/nginx                                       1.14.0              ecc98fc2f376        2 years ago         109 MB
    >   gcr.io/google_containers/kubernetes-dashboard-amd64   v1.8.3              0c60bcf89900        2 years ago         102 MB
    >   quay.io/coreos/flannel-cni                            v0.3.0              221392217215        3 years ago         49.8 MB
    >   gcr.io/google_containers/pause                        3.0                 99e59f495ffa        4 years ago         747 kB
    >   docker.io/janeczku/go-dnsmasq                         release-1.0.5       b5ed881a6857        4 years ago         9.05 MB


    #
    # So ... in theory, if we wanted to speed up the loading of a new image.
    # We could run docker pull on each of the target workerd nodes.
    #


# -----------------------------------------------------
# Login to each of our K8s workes and pull the image.
#[user@desktop]

    sshuser=fedora
    sshhost=128.232.227.158

    ssh "${sshuser:?}@${sshhost:?}"

        workers=(
            '10.0.0.40'
            '10.0.0.139'
            '10.0.0.111'
            '10.0.0.129'
            )

        for worker in ${workers[*]}
        do
            echo "---- ----"
            echo "Worker [${worker:?}]"
            ssh "${worker:?}" \
                '
                sudo docker pull --quiet "aglais/drupal-dev:latest"
                sudo docker pull --quiet "aglais/drupal-dev:20201208-131705"
                '
        done

    >   ....
    >   ....
    >   3a0a8363e6ae: Pull complete
    >   cf55bd6a3ada: Pull complete
    >   Digest: sha256:9e164003c152c1e94c1000f2d016b6c79860ab5d9490cb9535f6b392ff1e536d
    >   Status: Downloaded newer image for docker.io/aglais/drupal-dev:20201208-131705

    >   ....
    >   ....
    >   3a0a8363e6ae: Pull complete
    >   cf55bd6a3ada: Pull complete
    >   Digest: sha256:9e164003c152c1e94c1000f2d016b6c79860ab5d9490cb9535f6b392ff1e536d
    >   Status: Downloaded newer image for docker.io/aglais/drupal-dev:20201208-131705


    >   ....
    >   ....
    >   3a0a8363e6ae: Pull complete
    >   cf55bd6a3ada: Pull complete
    >   Digest: sha256:9e164003c152c1e94c1000f2d016b6c79860ab5d9490cb9535f6b392ff1e536d
    >   Status: Downloaded newer image for docker.io/aglais/drupal-dev:20201208-131705

    >   ....
    >   ....
    >   3a0a8363e6ae: Pull complete
    >   cf55bd6a3ada: Pull complete
    >   Digest: sha256:9e164003c152c1e94c1000f2d016b6c79860ab5d9490cb9535f6b392ff1e536d
    >   Status: Downloaded newer image for docker.io/aglais/drupal-dev:20201208-131705


